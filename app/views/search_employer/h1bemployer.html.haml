%script{:src => "https://www.google.com/jsapi", :type => "text/javascript"}

- require 'gchart'
.container-fluid	
	.row.search-page-main
		=render "layouts/nav-link-search-secondary"
		.row.first-row			
			.span12.show-search-tab-box
				.row
					= form_tag :search_employer_h1bemployer, :method => :get, :name=>"search_form" do
						.row
							.span6.offset2{:style=>"margin-top: 40px;"}
								.input-append									
									= text_field_tag :h1bemp_name, params[:h1bemp_name], :autocomplete => search_employer_autocomplete_h1bemp_name_path, :placeholder => "Employer Name", :value=> params[:h1bemp_name].presence || ""
									%a{:class=>"m-btn blue", :style => "margin-top: 0px; padding: 8px 14px", :href =>"javascript:search_form.submit();"}
										%i{:class=>"icon-search"}
										Search
				-if @search_h1bemp.present?
					.row		
						#content
							%ul#tabs.nav.nav-tabs{"data-tabs" => "tabs"}
								%li.active
									%a{"data-toggle" => "tab", :href => "#overview"} Overview
								%li
									%a{"data-toggle" => "tab", :href => "#h1b_gcstats"} H-1B / GC Stats
								%li
									%a{"data-toggle" => "tab", :href => "#top_jobs"} Top Jobs
								%li
									%a{"data-toggle" => "tab", :href => "#reviews"} Reviews
							#my-tab-content.tab-content
								#overview.tab-pane.active
									.span12.search-conditions-box
										.row
											.overview-title
												%p Employer Overview 											
										.row
											.overview-item{:style=>"margin-bottom: 20px;"}
												.span3
													%label 
														Previous H-1B History :
												.span2
													=overview_item @search_h1bemp.prevh1Flag
										.row
											.overview-item
												.span3
													%label 
														H-1B Approval Rate :
												.span2
													=overview_item @search_h1bemp.h1bARateFlag
										.row
											.overview-item
												.span3
													%label 
														E-Verified :
												.span2
													=overview_item @search_h1bemp.everifiedFlag
										.row
											.overview-item
												.span3
													%label 
														Previous GC History :
												.span2
													=overview_item @search_h1bemp.prevGCFlag
										.row
											.overview-item
												.span3
													%label 
														GC Approval Rate :
												.span2
													=overview_item @search_h1bemp.gcARateFlag
								#h1b_gcstats.tab-pane{:style=>"height:720px;"}
									.span12.h1b-gcstats
										.chart-content
											.row.stats-title
												%p H-1B and Green cards Statistics											
											.row
												.span10
													#h1b_chart
											.row{:style=>"margin-top:40px;"}
												.span10
													#gc_chart
										.chart-table-content
								#top_jobs.tab-pane{:style=>"height:720px;"}
									.span12.top-jobs
										.row.top-hired
											#top_hired
										.row.top-avg
											#top_avg
								#reviews.tab-pane
									.span12.reviews

:javascript 
	var cur_tab = 0
	$('.secodary ul li').eq(1).addClass('current-tab');
	$('.secodary ul li').eq(0).removeClass('current-tab');

	$("#tabs li").each(function(){
		$(this).removeClass("active");
	});
	$("#my-tab-content div").each(function(){
		$(this).removeClass("active");
	});	
	
	$("#tabs li").eq(cur_tab).addClass("active");
	$("#my-tab-content div.tab-pane").eq(cur_tab).addClass("active");
	var availableTags = #{@h1bemp_names}
	
	$( "#h1bemp_name" ).autocomplete({
		source: availableTags
	});

	google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart);
	var gc_chart_data = #{@gc_chart_data}
	var h1b_chart_data = #{@h1b_chart_data}
	var top_hire_data = #{@top_hired_data}
	console.log(top_hire_data);
	var top_avg_data = #{@top_avg_data}
	function drawChart() {
		var data = google.visualization.arrayToDataTable(gc_chart_data);
		var options = {
			title:"GC Filings Per Year",
			width:900, height:300,
			vAxis: {title: "Year"},
			hAxis: {title: "No. of GC Filings"},
			chartArea: {width: '60%'},
			isStacked: 1,
			series: [{color: 'Green', visibleInLegend: true}, {color: '#dc3912', visibleInLegend: true},{color: '#3366cc', visibleInLegend: true},{color: 'orange', visibleInLegend: true}]
		};
		var gc_chart = new google.visualization.BarChart(document.getElementById('gc_chart'));
		gc_chart.draw(data, options);

		data = google.visualization.arrayToDataTable(h1b_chart_data);
		options = {
			title:"LCA Filings (H-1B) Per Year",
			width:900, height:300,
			vAxis: {title: "Year"},
			hAxis: {title: "No. of LCA Filings - H-1B"},
			chartArea: {width: '60%'},
			isStacked: 1,
			series: [{color: 'Green', visibleInLegend: true}, {color: '#dc3912', visibleInLegend: true},{color: '#3366cc', visibleInLegend: true},{color: 'orange', visibleInLegend: true}]
		};
		var h1b_chart = new google.visualization.BarChart(document.getElementById('h1b_chart'));
		h1b_chart.draw(data, options);

		data = google.visualization.arrayToDataTable(top_hire_data);
		options = {
			title:"Total Jobs Hired",
			width:900, height:300,
			vAxis: {title: "Title"},
			hAxis: {title: "Total Hired"},
			chartArea: {width: '45%'}
		};
		var top_job_chart = new google.visualization.BarChart(document.getElementById('top_hired'));
		top_job_chart.draw(data, options);

		data = google.visualization.arrayToDataTable(top_avg_data);
		options = {
			title:"Total Jobs - Avg Salary",
			width:900, height:300,
			vAxis: {title: "Job Title"},
			hAxis: {title: "Salary(in $)"},
			chartArea: {width: '30%'}
		};
		var top_avg_chart = new google.visualization.BarChart(document.getElementById('top_avg'));
		top_avg_chart.draw(data, options);		
	}